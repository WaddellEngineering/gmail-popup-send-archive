# Send & Archive Button for Gmail Popup Compose

A Chrome extension that adds Gmail's **Send & Archive** button to the **popup compose window**, giving it the same one-click workflow already available in the inline reply compose.

---

## The problem

Gmail shows a **Send & Archive** button in the inline (in-thread) compose window, but that button is absent when you:

- Pop out a reply into its own floating window (the expand ↗ icon)
- Open a new compose popup and reply to a thread from there

This extension injects the same button into every popup compose window.

---

## How it works

| Step | What happens                                                                                                                                                                                                  |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | A `MutationObserver` watches for Gmail popup compose windows appearing inside the `.dw` container (the fixed area at the bottom of the Gmail viewport).                                                       |
| 2    | Once a compose window is detected, the extension finds Gmail's existing **Send** button and inserts a **Send & Archive** button immediately after it.                                                         |
| 3    | Clicking **Send & Archive** triggers the regular Send button.                                                                                                                                                 |
| 4    | A second `MutationObserver` watches for the compose window to be removed from the DOM (which Gmail does automatically after a successful send).                                                               |
| 5    | Once the compose window is gone, the extension clicks the **Archive** button in the conversation toolbar. If no Archive button is found, it dispatches Gmail's `e` keyboard shortcut (archive) as a fallback. |

---

## Installation

> Chrome Web Store submission is optional. Load the extension directly from your local files.

1. Open Chrome and navigate to `chrome://extensions`.
2. Enable **Developer mode** (toggle in the top-right corner).
3. Click **Load unpacked**.
4. Select the `Send Archive Button` folder (the one containing `manifest.json`).
5. The extension icon will appear in the toolbar. Navigate to Gmail — the button will appear automatically in any popup compose window.

### Icon setup (first time only)

The icons were generated by the PowerShell script during project creation and should already be in the `icons/` folder. If they are missing, open `generate-icons.html` in any browser — the three PNG files will be downloaded automatically. Place them in `icons/`:

```
icons/
  icon16.png
  icon48.png
  icon128.png
```

---

## File structure

```
Send Archive Button/
├── manifest.json          # Extension manifest (Manifest V3)
├── content.js             # Content script — button injection logic
├── styles.css             # CSS injected into Gmail
├── generate-icons.html    # One-time icon generator (open in browser)
└── icons/
    ├── icon16.png
    ├── icon48.png
    └── icon128.png
```

---

## Permissions

| Permission                                    | Why                                                     |
| --------------------------------------------- | ------------------------------------------------------- |
| `host_permissions: https://mail.google.com/*` | Required to inject the content script into Gmail pages. |

No other permissions are requested. The extension does not read email content, make network requests, or store any data.

---

## Troubleshooting

**The button doesn't appear**

- Make sure the extension is enabled on `chrome://extensions`.
- Reload the Gmail tab after installing or updating the extension.
- Gmail's class names can change after a Google update. Check the browser console for errors and open an issue.

**Clicking "Send & Archive" sends but doesn't archive**

- Gmail's keyboard shortcuts must be enabled. Go to **Gmail Settings → See all settings → General → Keyboard shortcuts → On**.
- If you are viewing a new email compose (not a reply), there is no thread to archive — the archive action is silently skipped.

**The button appears in the inline compose too**

- The extension only targets elements inside Gmail's `.dw` popup container, which is separate from inline reply composes. If you see it in both places, please open an issue with your Gmail version.

---

## Contributing / customising

All logic lives in `content.js`. Key functions:

| Function                            | Purpose                                                      |
| ----------------------------------- | ------------------------------------------------------------ |
| `findSendButton(composeEl)`         | Locates Gmail's Send button inside a compose element         |
| `injectButton(composeEl)`           | Builds and inserts the Send & Archive button                 |
| `watchComposeForRemoval(composeEl)` | Sets up the listener that fires archive after send           |
| `archiveCurrentConversation()`      | Clicks the Archive button or falls back to the `e` shortcut  |
| `scanAll()`                         | Scans the document for any unprocessed popup compose windows |

---

## License

MIT — use freely, modify as needed.
